name: ğŸ° Build Crazy Time Simulator EXE

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:
    inputs:
      create_release:
        description: 'Create a new release'
        required: false
        default: false
        type: boolean

jobs:
  build-windows-exe:
    runs-on: windows-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
    
    - name: ğŸ Set up Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        cache: 'pip'
    
    - name: ğŸ“¦ Install Python Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas openpyxl matplotlib pyinstaller pillow
        pip list
    
    - name: ğŸ“ Create PyInstaller Spec File
      run: |
        $specContent = @"
        # -*- mode: python ; coding: utf-8 -*-

        block_cipher = None

        a = Analysis(
            ['crazy_time_gui.py'],
            pathex=[],
            binaries=[],
            datas=[
                ('full_crazy_time_simulator.py', '.'),
            ],
            hiddenimports=[
                'pandas',
                'openpyxl',
                'tkinter',
                'tkinter.ttk',
                'tkinter.scrolledtext',
                'tkinter.messagebox',
                'threading',
                'queue',
                'json',
                'datetime',
                'time',
                'os',
                'sys',
                'random',
                'itertools',
                'collections',
                'pathlib',
                'shutil',
                'subprocess',
                'platform'
            ],
            hookspath=[],
            hooksconfig={},
            runtime_hooks=[],
            excludes=[
                'matplotlib.backends._backend_tk',
                'matplotlib.backends._backend_tkagg',
                'PIL._tkinter_finder'
            ],
            win_no_prefer_redirects=False,
            win_private_assemblies=False,
            cipher=block_cipher,
            noarchive=False,
        )

        pyz = PYZ(a.pure, a.zipped_data, cipher=block_cipher)

        exe = EXE(
            pyz,
            a.scripts,
            a.binaries,
            a.zipfiles,
            a.datas,
            [],
            name='CrazyTimeSimulator',
            debug=False,
            bootloader_ignore_signals=False,
            strip=False,
            upx=True,
            upx_exclude=[],
            runtime_tmpdir=None,
            console=False,
            disable_windowed_traceback=False,
            argv_emulation=False,
            target_arch=None,
            codesign_identity=None,
            entitlements_file=None,
        )
        "@
        
        $specContent | Out-File -FilePath "crazy_time_simulator.spec" -Encoding UTF8
        Write-Host "âœ… Created PyInstaller spec file"
    
    - name: ğŸ”¨ Build EXE with PyInstaller
      run: |
        Write-Host "ğŸ”¨ Building EXE file..."
        pyinstaller --clean --noconfirm crazy_time_simulator.spec
        
        if (Test-Path "dist\CrazyTimeSimulator.exe") {
            $size = [math]::Round((Get-Item "dist\CrazyTimeSimulator.exe").Length / 1MB, 2)
            Write-Host "âœ… EXE built successfully! Size: $size MB"
        } else {
            Write-Host "âŒ EXE build failed!"
            exit 1
        }
    
    - name: ğŸ“‹ Create README for Release
      run: |
        $readmeContent = @"
        # ğŸ° Ù…Ø­Ø§ÙƒÙŠ Crazy Time - Ø¥ØµØ¯Ø§Ø± Windows

        ## ğŸš€ ÙƒÙŠÙÙŠØ© Ø§Ù„ØªØ´ØºÙŠÙ„

        1. **Ø­Ù…Ù„ Ø§Ù„Ù…Ù„Ù**: CrazyTimeSimulator.exe
        2. **ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù„Ù**: Ø§Ù†Ù‚Ø± Ù†Ù‚Ø±Ø§Ù‹ Ù…Ø²Ø¯ÙˆØ¬Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ù
        3. **Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬**: Ø¥Ø°Ø§ Ø¸Ù‡Ø± ØªØ­Ø°ÙŠØ± Ø£Ù…Ù†ÙŠØŒ Ø§Ø®ØªØ± "ØªØ´ØºÙŠÙ„ Ø¹Ù„Ù‰ Ø£ÙŠ Ø­Ø§Ù„"
        4. **Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ**: Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø³ÙˆÙ…ÙŠØ© Ø³ØªØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹

        ## ğŸ“‹ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…

        - **Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„**: Windows 7/8/10/11 (64-bit)
        - **Ø§Ù„Ø°Ø§ÙƒØ±Ø©**: 4 GB RAM Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„
        - **Ø§Ù„Ù…Ø³Ø§Ø­Ø©**: 2 GB Ù…Ø³Ø§Ø­Ø© ÙØ§Ø±ØºØ© Ù„Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ + 5 GB Ù„Ù„Ù†ØªØ§Ø¦Ø¬
        - **Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬**: Ø£ÙŠ Ù…Ø¹Ø§Ù„Ø¬ Ø­Ø¯ÙŠØ«
        - **Ø§Ù„Ø´Ø§Ø´Ø©**: Ø¯Ù‚Ø© 1024x768 Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„

        ## ğŸ¯ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª

        - âœ… **ÙˆØ§Ø¬Ù‡Ø© Ø±Ø³ÙˆÙ…ÙŠØ© Ù…ØªÙ‚Ø¯Ù…Ø©** - Ø³Ù‡Ù„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
        - âœ… **Ù…Ø­Ø§ÙƒØ§Ø© Ø´Ø§Ù…Ù„Ø©** - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù…ÙƒÙ†Ø© (3+ Ù…Ù„ÙŠÙˆÙ† ØªØ±ÙƒÙŠØ¨Ø©)
        - âœ… **Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ** - Ù„Ø§ ØªÙÙ‚Ø¯ ØªÙ‚Ø¯Ù…Ùƒ Ø£Ø¨Ø¯Ø§Ù‹
        - âœ… **Ø¥ÙŠÙ‚Ø§Ù ÙˆØ§Ø³ØªØ¦Ù†Ø§Ù** - ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©
        - âœ… **Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø©** - Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªÙ‚Ø¯Ù… ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬
        - âœ… **Ù†ØªØ§Ø¦Ø¬ Excel** - ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„ ÙˆÙ‚Ø§Ø¨Ù„ Ù„Ù„ÙÙ„ØªØ±Ø©

        ## âš ï¸ ØªØ­Ø°ÙŠØ±Ø§Øª Ù…Ù‡Ù…Ø©

        ### Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©:
        - **Ø§Ù„ÙˆÙ‚Øª**: 80+ Ø³Ø§Ø¹Ø© Ù„Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
        - **Ø§Ù„Ù…Ø³Ø§Ø­Ø©**: Ø¹Ø¯Ø© GB Ù„Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
        - **Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ**: Ø¹Ø§Ù„ÙŠ Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬ ÙˆØ§Ù„Ø°Ø§ÙƒØ±Ø©

        ### Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø£Ù…Ø«Ù„:
        1. Ø£ØºÙ„Ù‚ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ø£Ø®Ø±Ù‰ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©
        2. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø·Ø§Ù‚Ø© (Ø´Ø§Ø­Ù† Ù…ØªØµÙ„ Ù„Ù„Ø§Ø¨ØªÙˆØ¨)
        3. Ø§Ø³ØªØ®Ø¯Ù… ÙØªØ±Ø© Ø­ÙØ¸ Ù‚ØµÙŠØ±Ø© (10 ØªØ±ÙƒÙŠØ¨Ø§Øª)
        4. Ù„Ø§ ØªØºÙ„Ù‚ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø£Ø«Ù†Ø§Ø¡ Ø±Ø³Ø§Ù„Ø© "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸"

        ## ğŸ”§ Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡

        ### Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬:
        1. **ØªØ´ØºÙŠÙ„ ÙƒÙ…Ø¯ÙŠØ±**: Ø§Ù†Ù‚Ø± Ø¨Ø§Ù„Ø²Ø± Ø§Ù„Ø£ÙŠÙ…Ù† ÙˆØ§Ø®ØªØ± "Run as administrator"
        2. **ØªØ­Ø¯ÙŠØ« Windows**: ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù…
        3. **Ø¨Ø±Ø§Ù…Ø¬ Ù…ÙƒØ§ÙØ­Ø© Ø§Ù„ÙÙŠØ±ÙˆØ³Ø§Øª**: Ø£Ø¶Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù„Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª
        4. **Visual C++ Redistributable**: Ù‚Ù… Ø¨ØªØ­Ù…ÙŠÙ„Ù‡ Ù…Ù† Microsoft

        ---

        # ğŸ° Crazy Time Simulator - Windows Release

        ## ğŸš€ How to Run

        1. **Download**: CrazyTimeSimulator.exe
        2. **Run**: Double-click the file
        3. **Allow**: If security warning appears, choose "Run anyway"
        4. **Enjoy**: GUI will appear automatically

        ## ğŸ“‹ System Requirements

        - **OS**: Windows 7/8/10/11 (64-bit)
        - **RAM**: 4 GB minimum
        - **Storage**: 2 GB for program + 5 GB for results
        - **CPU**: Any modern processor
        - **Display**: 1024x768 minimum resolution

        ## ğŸ¯ Features

        - âœ… **Advanced GUI** - Easy to use
        - âœ… **Complete Simulation** - All possibilities (3+ million combinations)
        - âœ… **Auto-Save** - Never lose progress
        - âœ… **Pause/Resume** - Full control
        - âœ… **Live Statistics** - Real-time monitoring
        - âœ… **Excel Results** - Detailed analysis

        ## âš ï¸ Important Warnings

        ### Full Simulation:
        - **Time**: 80+ hours for complete simulation
        - **Storage**: Several GB for final results
        - **Usage**: High CPU and memory consumption

        ### Performance Tips:
        1. Close other programs during simulation
        2. Ensure power supply (laptop charger)
        3. Use short save intervals (10 combinations)
        4. Don't close during "Saving..." message

        ## ğŸ”§ Troubleshooting

        ### If program doesn't start:
        1. **Run as Administrator**: Right-click â†’ "Run as administrator"
        2. **Update Windows**: Ensure system is updated
        3. **Antivirus**: Add program to exceptions
        4. **Visual C++ Redistributable**: Download from Microsoft

        ---

        **ğŸ° Enjoy the most advanced Crazy Time Simulator!**
        "@
        
        $readmeContent | Out-File -FilePath "README_RELEASE.md" -Encoding UTF8
        Write-Host "âœ… Created release README"
    
    - name: ğŸ“¦ Create Release Package
      run: |
        Write-Host "ğŸ“¦ Creating release package..."
        
        # Create release directory
        New-Item -ItemType Directory -Force -Path "release_package"
        
        # Copy EXE file
        Copy-Item "dist\CrazyTimeSimulator.exe" "release_package\"
        
        # Copy README
        Copy-Item "README_RELEASE.md" "release_package\README.md"
        
        # Create simple text README for non-technical users
        $simpleReadme = @"
        ğŸ° Ù…Ø­Ø§ÙƒÙŠ Crazy Time
        ==================

        ğŸš€ Ù„Ù„ØªØ´ØºÙŠÙ„:
        Ø§Ù†Ù‚Ø± Ù†Ù‚Ø±Ø§Ù‹ Ù…Ø²Ø¯ÙˆØ¬Ø§Ù‹ Ø¹Ù„Ù‰ CrazyTimeSimulator.exe

        ğŸ“‹ Ù…ØªØ·Ù„Ø¨Ø§Øª:
        - Windows 7/8/10/11
        - 4 GB Ø°Ø§ÙƒØ±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„

        âš ï¸ Ù…Ù‡Ù…:
        - Ø¥Ø°Ø§ Ø¸Ù‡Ø± ØªØ­Ø°ÙŠØ± Ø£Ù…Ù†ÙŠØŒ Ø§Ø®ØªØ± "ØªØ´ØºÙŠÙ„ Ø¹Ù„Ù‰ Ø£ÙŠ Ø­Ø§Ù„"
        - Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© ØªØ³ØªØºØ±Ù‚ 80+ Ø³Ø§Ø¹Ø©
        - ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø§Ø­Ø© ÙƒØ§ÙÙŠØ© (5+ GB)

        ğŸ“– Ù„Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„ØŒ Ø§Ù‚Ø±Ø£ README.md

        ---

        ğŸ° Crazy Time Simulator
        =======================

        ğŸš€ To Run:
        Double-click CrazyTimeSimulator.exe

        ğŸ“‹ Requirements:
        - Windows 7/8/10/11
        - 4 GB RAM minimum

        âš ï¸ Important:
        - If security warning appears, choose "Run anyway"
        - Full simulation takes 80+ hours
        - Ensure sufficient space (5+ GB)

        ğŸ“– For more details, read README.md
        "@
        
        $simpleReadme | Out-File -FilePath "release_package\QUICK_START.txt" -Encoding UTF8
        
        # Get file size
        $exeSize = [math]::Round((Get-Item "release_package\CrazyTimeSimulator.exe").Length / 1MB, 2)
        Write-Host "ğŸ“Š Package created! EXE size: $exeSize MB"
        
        # List package contents
        Write-Host "ğŸ“‹ Package contents:"
        Get-ChildItem "release_package" | ForEach-Object { Write-Host "   - $($_.Name)" }
    
    - name: ğŸ§ª Test EXE (Quick Validation)
      run: |
        Write-Host "ğŸ§ª Testing EXE file..."
        
        # Test if EXE can be executed (will fail due to no display, but should not crash immediately)
        $process = Start-Process -FilePath "release_package\CrazyTimeSimulator.exe" -ArgumentList "--version" -PassThru -NoNewWindow -Wait -ErrorAction SilentlyContinue
        
        if ($process.ExitCode -eq 0 -or $process.ExitCode -eq $null) {
            Write-Host "âœ… EXE validation passed"
        } else {
            Write-Host "âš ï¸ EXE validation completed (exit code: $($process.ExitCode))"
        }
    
    - name: ğŸ“¤ Upload Build Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: CrazyTimeSimulator-Windows-${{ github.sha }}
        path: release_package/
        retention-days: 30
    
    - name: ğŸ“Š Build Summary
      run: |
        Write-Host ""
        Write-Host "ğŸ‰ Build completed successfully!"
        Write-Host "================================"
        
        $exeSize = [math]::Round((Get-Item "release_package\CrazyTimeSimulator.exe").Length / 1MB, 2)
        $buildTime = Get-Date -Format "yyyy-MM-dd HH:mm:ss UTC"
        
        Write-Host "ğŸ“Š Build Information:"
        Write-Host "   â€¢ EXE Size: $exeSize MB"
        Write-Host "   â€¢ Build Time: $buildTime"
        Write-Host "   â€¢ Commit: ${{ github.sha }}"
        Write-Host "   â€¢ Branch: ${{ github.ref_name }}"
        Write-Host ""
        Write-Host "ğŸ“¥ Download Instructions:"
        Write-Host "   1. Go to Actions tab in GitHub"
        Write-Host "   2. Click on this workflow run"
        Write-Host "   3. Download 'CrazyTimeSimulator-Windows-${{ github.sha }}'"
        Write-Host "   4. Extract and run CrazyTimeSimulator.exe"
        Write-Host ""
        Write-Host "âœ… Ready for distribution!"

